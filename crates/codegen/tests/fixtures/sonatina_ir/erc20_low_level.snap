---
source: crates/codegen/tests/sonatina_ir.rs
expression: output
input_file: crates/codegen/tests/fixtures/erc20_low_level.fe
---
target = evm-ethereum-osaka

func public %abi_encode_u256(v0.i256, v1.i256) {
    block0:
        mstore 0.i256 v0 i256;
        evm_return 0.i256 32.i256;
}

func public %abi_encode_string(v0.i256, v1.i256, v2.i256) {
    block0:
        mstore 0.i256 32.i256 i256;
        mstore 32.i256 v1 i256;
        mstore 64.i256 v0 i256;
        evm_return 0.i256 96.i256;
}

func public %erc20_balance_of(v0.i256, v1.i256) -> i256 {
    block0:
        v3.i256 = call %storagemap_k__v__const_salt__u256__get__Address_u256_0__b8b2f68065fe2328 v1;
        return v3;
}

func public %erc20_allowance(v0.i256, v1.i256, v2.i256) -> i256 {
    block0:
        v5.i256 = evm_malloc 64.i256;
        mstore v5 v1 i256;
        v7.i256 = add v5 32.i256;
        mstore v7 v2 i256;
        v8.i256 = call %storagemap_k__v__const_salt__u256__get___Address__Address__u256_1__12414c27d5bfff1f v5;
        return v8;
}

func public %erc20_approve(v0.i256, v1.i256, v2.i256, v3.i256) {
    block0:
        v6.i256 = evm_malloc 64.i256;
        mstore v6 v1 i256;
        v8.i256 = add v6 32.i256;
        mstore v8 v2 i256;
        call %storagemap_k__v__const_salt__u256__set___Address__Address__u256_1__12414c27d5bfff1f v6 v3;
        return;
}

func public %erc20_total_supply(v0.i256) -> i256 {
    block0:
        v2.i256 = mload v0 i256;
        return v2;
}

func public %erc20_set_owner_once(v0.i256, v1.i256, v2.i256) {
    block0:
        v5.i256 = add v0 32.i256;
        v6.i256 = mload v5 i256;
        v7.i256 = call %address_zero;
        v8.i256 = eq v6 v7;
        v9.i256 = is_zero v8;
        br v9 block1 block2;

    block1:
        evm_revert 0.i256 0.i256;

    block2:
        v12.i256 = add v0 32.i256;
        mstore v12 v1 i256;
        return;
}

func public %erc20_transfer(v0.i256, v1.i256, v2.i256, v3.i256, v4.i256) {
    block0:
        v6.i256 = call %erc20_balance_of_mem v0 v1;
        v7.i256 = lt v6 v3;
        br v7 block1 block2;

    block1:
        evm_revert 0.i256 0.i256;

    block2:
        v10.i256 = call %erc20_balance_of_mem v0 v2;
        v14.i256 = sub v6 v3;
        call %storagemap_k__v__const_salt__u256__set__Address_u256_0__b8b2f68065fe2328 v1 v14;
        v15.i256 = add v10 v3;
        call %storagemap_k__v__const_salt__u256__set__Address_u256_0__b8b2f68065fe2328 v2 v15;
        return;
}

func public %erc20_transfer_from(v0.i256, v1.i256, v2.i256, v3.i256, v4.i256, v5.i256) {
    block0:
        v7.i256 = evm_caller;
        v8.i256 = call %erc20_allowance_mem v0 v1 v7;
        v9.i256 = lt v8 v3;
        br v9 block1 block2;

    block1:
        evm_revert 0.i256 0.i256;

    block2:
        call %erc20_transfer_mem v0 v1 v2 v3 v5;
        v16.i256 = evm_malloc 64.i256;
        mstore v16 v1 i256;
        v19.i256 = add v16 32.i256;
        mstore v19 v7 i256;
        v21.i256 = sub v8 v3;
        call %storagemap_k__v__const_salt__u256__set___Address__Address__u256_1__12414c27d5bfff1f v16 v21;
        return;
}

func public %erc20_mint(v0.i256, v1.i256, v2.i256, v3.i256, v4.i256) {
    block0:
        v6.i256 = evm_caller;
        v8.i256 = add v0 32.i256;
        v9.i256 = mload v8 i256;
        v10.i256 = eq v6 v9;
        v11.i256 = is_zero v10;
        br v11 block1 block2;

    block1:
        evm_revert 0.i256 0.i256;

    block2:
        v14.i256 = call %erc20_balance_of_mem v0 v1;
        v16.i256 = add v14 v2;
        call %storagemap_k__v__const_salt__u256__set__Address_u256_0__b8b2f68065fe2328 v1 v16;
        v17.i256 = mload v0 i256;
        v18.i256 = add v17 v2;
        mstore v0 v18 i256;
        return;
}

func public %do_init__StorPtr_Erc20___2745299687a147d4(v0.i256, v1.i256, v2.i256) {
    block0:
        v4.i256 = evm_caller;
        call %erc20_set_owner_once_stor v0 v4 v2;
        return;
}

func public %balance_of__StorPtr_Erc20___2745299687a147d4(v0.i256, v1.i256) -> i256 {
    block0:
        v3.i256 = call %storagemap_k__v__const_salt__u256__get__Address_u256_0__b8b2f68065fe2328 v0;
        return v3;
}

func public %allowance__StorPtr_Erc20___2745299687a147d4(v0.i256, v1.i256, v2.i256) -> i256 {
    block0:
        v5.i256 = evm_malloc 64.i256;
        mstore v5 v0 i256;
        v7.i256 = add v5 32.i256;
        mstore v7 v1 i256;
        v8.i256 = call %storagemap_k__v__const_salt__u256__get___Address__Address__u256_1__12414c27d5bfff1f v5;
        return v8;
}

func public %transfer__StorPtr_Erc20___2745299687a147d4(v0.i256, v1.i256, v2.i256, v3.i256, v4.i256) -> i256 {
    block0:
        v6.i256 = evm_caller;
        call %erc20_transfer_stor v2 v6 v0 v1 v4;
        return 1.i256;
}

func public %approve__StorPtr_Erc20___2745299687a147d4(v0.i256, v1.i256, v2.i256, v3.i256) -> i256 {
    block0:
        v5.i256 = evm_caller;
        call %erc20_approve_stor v2 v5 v0 v1;
        return 1.i256;
}

func public %transfer_from__StorPtr_Erc20___2745299687a147d4(v0.i256, v1.i256, v2.i256, v3.i256, v4.i256, v5.i256) -> i256 {
    block0:
        call %erc20_transfer_from_stor v3 v0 v1 v2 v4 v5;
        return 1.i256;
}

func public %mint__StorPtr_Erc20___2745299687a147d4(v0.i256, v1.i256, v2.i256, v3.i256, v4.i256) -> i256 {
    block0:
        call %erc20_mint_stor v2 v0 v1 v3 v4;
        return 1.i256;
}

func public %init__StorPtr_Evm___207f35a85ac4062e() {
    block0:
        v1.i256 = call %stor_ptr__Evm_Erc20__c294a0aeae425afd 0.i256;
        call %do_init__StorPtr_Erc20___2745299687a147d4 v1 0.i256 0.i256;
        v2.i256 = sym_size &runtime__StorPtr_Evm___207f35a85ac4062e;
        v3.i256 = sym_addr &runtime__StorPtr_Evm___207f35a85ac4062e;
        evm_code_copy 0.i256 v3 v2;
        evm_return 0.i256 v2;
}

func public %runtime__StorPtr_Evm___207f35a85ac4062e() {
    block0:
        v1.i256 = call %stor_ptr__Evm_Erc20__c294a0aeae425afd 0.i256;
        v2.i256 = evm_calldata_load 0.i256;
        v4.i256 = shr 224.i256 v2;
        jump block11;

    block1:
        v6.i256 = evm_calldata_load 4.i256;
        v8.i256 = call %balance_of__StorPtr_Erc20___2745299687a147d4 v6 v1;
        call %abi_encode_u256 v8 0.i256;
        evm_invalid;

    block2:
        v9.i256 = evm_calldata_load 4.i256;
        v11.i256 = evm_calldata_load 36.i256;
        v13.i256 = call %allowance__StorPtr_Erc20___2745299687a147d4 v9 v11 v1;
        call %abi_encode_u256 v13 0.i256;
        evm_invalid;

    block3:
        call %abi_encode_string 31840933704928615426292613906591192052886564858731089189578963311002547912704.i256 7.i256 0.i256;
        evm_invalid;

    block4:
        call %abi_encode_string 31784391594991486112232083260356792451358613714049171750120207607087736291328.i256 3.i256 0.i256;
        evm_invalid;

    block5:
        call %abi_encode_u256 18.i256 0.i256;
        evm_invalid;

    block6:
        v19.i256 = evm_calldata_load 4.i256;
        v20.i256 = evm_calldata_load 36.i256;
        v22.i256 = call %transfer__StorPtr_Erc20___2745299687a147d4 v19 v20 v1 0.i256 0.i256;
        call %abi_encode_u256 v22 0.i256;
        evm_invalid;

    block7:
        v23.i256 = evm_calldata_load 4.i256;
        v24.i256 = evm_calldata_load 36.i256;
        v26.i256 = call %approve__StorPtr_Erc20___2745299687a147d4 v23 v24 v1 0.i256;
        call %abi_encode_u256 v26 0.i256;
        evm_invalid;

    block8:
        v27.i256 = evm_calldata_load 4.i256;
        v28.i256 = evm_calldata_load 36.i256;
        v30.i256 = evm_calldata_load 68.i256;
        v32.i256 = call %transfer_from__StorPtr_Erc20___2745299687a147d4 v27 v28 v30 v1 0.i256 0.i256;
        call %abi_encode_u256 v32 0.i256;
        evm_invalid;

    block9:
        v33.i256 = evm_calldata_load 4.i256;
        v34.i256 = evm_calldata_load 36.i256;
        v36.i256 = call %mint__StorPtr_Erc20___2745299687a147d4 v33 v34 v1 0.i256 0.i256;
        call %abi_encode_u256 v36 0.i256;
        evm_invalid;

    block10:
        evm_revert 0.i256 0.i256;

    block11:
        v47.i256 = eq v4 1889567281.i256;
        br v47 block1 block12;

    block12:
        v48.i256 = eq v4 3714247998.i256;
        br v48 block2 block13;

    block13:
        v49.i256 = eq v4 117300739.i256;
        br v49 block3 block14;

    block14:
        v50.i256 = eq v4 2514000705.i256;
        br v50 block4 block15;

    block15:
        v51.i256 = eq v4 826074471.i256;
        br v51 block5 block16;

    block16:
        v52.i256 = eq v4 2835717307.i256;
        br v52 block6 block17;

    block17:
        v53.i256 = eq v4 157198259.i256;
        br v53 block7 block18;

    block18:
        v54.i256 = eq v4 599290589.i256;
        br v54 block8 block19;

    block19:
        v55.i256 = eq v4 1086394137.i256;
        br v55 block9 block10;
}

func public %storagemap_k__v__const_salt__u256__get__Address_u256_0__b8b2f68065fe2328(v0.i256) -> i256 {
    block0:
        v2.i256 = call %storagemap_get_word_with_salt__Address__ce8f588742192062 v0 0.i256;
        v3.i256 = call %u256_wordrepr_from_word v2;
        return v3;
}

func public %storagemap_k__v__const_salt__u256__get___Address__Address__u256_1__12414c27d5bfff1f(v0.i256) -> i256 {
    block0:
        v3.i256 = call %storagemap_get_word_with_salt___Address__Address___c32d499da259c78e v0 1.i256;
        v4.i256 = call %u256_wordrepr_from_word v3;
        return v4;
}

func public %storagemap_k__v__const_salt__u256__set___Address__Address__u256_1__12414c27d5bfff1f(v0.i256, v1.i256) {
    block0:
        v3.i256 = call %u256_wordrepr_to_word v1;
        call %storagemap_set_word_with_salt___Address__Address___c32d499da259c78e v0 1.i256 v3;
        return;
}

func public %address_zero() -> i256 {
    block0:
        return 0.i256;
}

func public %erc20_balance_of_mem(v0.i256, v1.i256) -> i256 {
    block0:
        v3.i256 = call %storagemap_k__v__const_salt__u256__get__Address_u256_0__b8b2f68065fe2328 v1;
        return v3;
}

func public %storagemap_k__v__const_salt__u256__set__Address_u256_0__b8b2f68065fe2328(v0.i256, v1.i256) {
    block0:
        v3.i256 = call %u256_wordrepr_to_word v1;
        call %storagemap_set_word_with_salt__Address__ce8f588742192062 v0 0.i256 v3;
        return;
}

func public %erc20_allowance_mem(v0.i256, v1.i256, v2.i256) -> i256 {
    block0:
        v5.i256 = evm_malloc 64.i256;
        mstore v5 v1 i256;
        v7.i256 = add v5 32.i256;
        mstore v7 v2 i256;
        v8.i256 = call %storagemap_k__v__const_salt__u256__get___Address__Address__u256_1__12414c27d5bfff1f v5;
        return v8;
}

func public %erc20_transfer_mem(v0.i256, v1.i256, v2.i256, v3.i256, v4.i256) {
    block0:
        v6.i256 = call %erc20_balance_of_mem v0 v1;
        v7.i256 = lt v6 v3;
        br v7 block1 block2;

    block1:
        evm_revert 0.i256 0.i256;

    block2:
        v10.i256 = call %erc20_balance_of_mem v0 v2;
        v14.i256 = sub v6 v3;
        call %storagemap_k__v__const_salt__u256__set__Address_u256_0__b8b2f68065fe2328 v1 v14;
        v15.i256 = add v10 v3;
        call %storagemap_k__v__const_salt__u256__set__Address_u256_0__b8b2f68065fe2328 v2 v15;
        return;
}

func public %erc20_set_owner_once_stor(v0.i256, v1.i256, v2.i256) {
    block0:
        v5.i256 = add v0 1.i256;
        v6.i256 = evm_sload v5;
        v7.i256 = call %address_zero;
        v8.i256 = eq v6 v7;
        v9.i256 = is_zero v8;
        br v9 block1 block2;

    block1:
        evm_revert 0.i256 0.i256;

    block2:
        v12.i256 = add v0 1.i256;
        evm_sstore v12 v1;
        return;
}

func public %erc20_transfer_stor(v0.i256, v1.i256, v2.i256, v3.i256, v4.i256) {
    block0:
        v6.i256 = call %erc20_balance_of_stor v0 v1;
        v7.i256 = lt v6 v3;
        br v7 block1 block2;

    block1:
        evm_revert 0.i256 0.i256;

    block2:
        v10.i256 = call %erc20_balance_of_stor v0 v2;
        v14.i256 = sub v6 v3;
        call %storagemap_k__v__const_salt__u256__set__Address_u256_0__b8b2f68065fe2328 v1 v14;
        v15.i256 = add v10 v3;
        call %storagemap_k__v__const_salt__u256__set__Address_u256_0__b8b2f68065fe2328 v2 v15;
        return;
}

func public %erc20_approve_stor(v0.i256, v1.i256, v2.i256, v3.i256) {
    block0:
        v6.i256 = evm_malloc 64.i256;
        mstore v6 v1 i256;
        v8.i256 = add v6 32.i256;
        mstore v8 v2 i256;
        call %storagemap_k__v__const_salt__u256__set___Address__Address__u256_1__12414c27d5bfff1f v6 v3;
        return;
}

func public %erc20_transfer_from_stor(v0.i256, v1.i256, v2.i256, v3.i256, v4.i256, v5.i256) {
    block0:
        v7.i256 = evm_caller;
        v8.i256 = call %erc20_allowance_stor v0 v1 v7;
        v9.i256 = lt v8 v3;
        br v9 block1 block2;

    block1:
        evm_revert 0.i256 0.i256;

    block2:
        call %erc20_transfer_stor v0 v1 v2 v3 v5;
        v16.i256 = evm_malloc 64.i256;
        mstore v16 v1 i256;
        v19.i256 = add v16 32.i256;
        mstore v19 v7 i256;
        v21.i256 = sub v8 v3;
        call %storagemap_k__v__const_salt__u256__set___Address__Address__u256_1__12414c27d5bfff1f v16 v21;
        return;
}

func public %erc20_mint_stor(v0.i256, v1.i256, v2.i256, v3.i256, v4.i256) {
    block0:
        v6.i256 = evm_caller;
        v8.i256 = add v0 1.i256;
        v9.i256 = evm_sload v8;
        v10.i256 = eq v6 v9;
        v11.i256 = is_zero v10;
        br v11 block1 block2;

    block1:
        evm_revert 0.i256 0.i256;

    block2:
        v14.i256 = call %erc20_balance_of_stor v0 v1;
        v16.i256 = add v14 v2;
        call %storagemap_k__v__const_salt__u256__set__Address_u256_0__b8b2f68065fe2328 v1 v16;
        v17.i256 = evm_sload v0;
        v18.i256 = add v17 v2;
        evm_sstore v0 v18;
        return;
}

func public %stor_ptr__Evm_Erc20__c294a0aeae425afd(v0.i256) -> i256 {
    block0:
        v2.i256 = call %storptr_t__effectref_from_raw__Erc20__88e369469f2b52ef v0;
        return v2;
}

func public %storagemap_get_word_with_salt__Address__ce8f588742192062(v0.i256, v1.i256) -> i256 {
    block0:
        v3.i256 = call %storagemap_storage_slot_with_salt__Address__ce8f588742192062 v0 v1;
        v4.i256 = evm_sload v3;
        return v4;
}

func public %u256_wordrepr_from_word(v0.i256) -> i256 {
    block0:
        return v0;
}

func public %storagemap_get_word_with_salt___Address__Address___c32d499da259c78e(v0.i256, v1.i256) -> i256 {
    block0:
        v3.i256 = call %storagemap_storage_slot_with_salt___Address__Address___c32d499da259c78e v0 v1;
        v4.i256 = evm_sload v3;
        return v4;
}

func public %u256_wordrepr_to_word(v0.i256) -> i256 {
    block0:
        return v0;
}

func public %storagemap_set_word_with_salt___Address__Address___c32d499da259c78e(v0.i256, v1.i256, v2.i256) {
    block0:
        v4.i256 = call %storagemap_storage_slot_with_salt___Address__Address___c32d499da259c78e v0 v1;
        evm_sstore v4 v2;
        return;
}

func public %storagemap_set_word_with_salt__Address__ce8f588742192062(v0.i256, v1.i256, v2.i256) {
    block0:
        v4.i256 = call %storagemap_storage_slot_with_salt__Address__ce8f588742192062 v0 v1;
        evm_sstore v4 v2;
        return;
}

func public %erc20_balance_of_stor(v0.i256, v1.i256) -> i256 {
    block0:
        v3.i256 = call %storagemap_k__v__const_salt__u256__get__Address_u256_0__b8b2f68065fe2328 v1;
        return v3;
}

func public %erc20_allowance_stor(v0.i256, v1.i256, v2.i256) -> i256 {
    block0:
        v5.i256 = evm_malloc 64.i256;
        mstore v5 v1 i256;
        v7.i256 = add v5 32.i256;
        mstore v7 v2 i256;
        v8.i256 = call %storagemap_k__v__const_salt__u256__get___Address__Address__u256_1__12414c27d5bfff1f v5;
        return v8;
}

func public %storptr_t__effectref_from_raw__Erc20__88e369469f2b52ef(v0.i256) -> i256 {
    block0:
        return v0;
}

func public %storagemap_storage_slot_with_salt__Address__ce8f588742192062(v0.i256, v1.i256) -> i256 {
    block0:
        v4.i256 = call %address_storagekey_write_key 4096.i256 v0;
        v5.i256 = add 4096.i256 v4;
        mstore v5 v1 i256;
        v7.i256 = add v4 32.i256;
        v8.i256 = evm_keccak256 4096.i256 v7;
        return v8;
}

func public %storagemap_storage_slot_with_salt___Address__Address___c32d499da259c78e(v0.i256, v1.i256) -> i256 {
    block0:
        v4.i256 = call %_a__b__storagekey_write_key__Address_Address__397b9a625a435b6f 4096.i256 v0;
        v5.i256 = add 4096.i256 v4;
        mstore v5 v1 i256;
        v7.i256 = add v4 32.i256;
        v8.i256 = evm_keccak256 4096.i256 v7;
        return v8;
}

func public %address_storagekey_write_key(v0.i256, v1.i256) -> i256 {
    block0:
        v3.i256 = call %u256_storagekey_write_key v0 v1;
        return v3;
}

func public %_a__b__storagekey_write_key__Address_Address__397b9a625a435b6f(v0.i256, v1.i256) -> i256 {
    block0:
        v3.i256 = mload v1 i256;
        v5.i256 = add v1 32.i256;
        v6.i256 = mload v5 i256;
        v7.i256 = call %address_storagekey_write_key v0 v3;
        v8.i256 = add v0 v7;
        v9.i256 = call %address_storagekey_write_key v8 v6;
        v10.i256 = add v7 v9;
        return v10;
}

func public %u256_storagekey_write_key(v0.i256, v1.i256) -> i256 {
    block0:
        mstore v0 v1 i256;
        return 32.i256;
}


object @Erc20Contract {
    section init {
        entry %init__StorPtr_Evm___207f35a85ac4062e;
        embed .runtime as &runtime__StorPtr_Evm___207f35a85ac4062e;
    }
    section runtime {
        entry %runtime__StorPtr_Evm___207f35a85ac4062e;
    }
}
